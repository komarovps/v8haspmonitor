#Использовать "../src"
#Использовать "./fixtures"
#Использовать asserts
#Использовать moskito
#Использовать logos

Перем МониторАппаратныхКлючей;
Перем ИсполнительКоманд;

Процедура ПередЗапускомТеста() Экспорт

    Лог = Служебный.Лог();
    Лог.УстановитьУровень(УровниЛога.Отладка);

    Если МониторАппаратныхКлючей = Неопределено Тогда
        МониторАппаратныхКлючей = Новый МониторАппаратныхКлючей;
    КонецЕсли;

    Если ИсполнительКоманд = Неопределено Тогда
        ИсполнительКоманд = Мок.Получить(Новый ИсполнительКоманд);
    КонецЕсли;

    МониторАппаратныхКлючей.УстановитьИсполнительКоманд(ИсполнительКоманд);

КонецПроцедуры // ПередЗапускомТеста()

// основной метод для тестирования
Функция ПолучитьСписокТестов(ЮнитТестирование) Экспорт
    
    ВсеТесты = Новый Массив;
    
    ВсеТесты.Добавить("ТестДолжен_ПолучитьСписокМенеджеровЛицензий");	
    ВсеТесты.Добавить("ТестДолжен_ПолучитьСписокКлючейМенеджеровЛицензий");	
    ВсеТесты.Добавить("ТестДолжен_ПолучитьСписокПодключений");	

    Возврат ВсеТесты;

КонецФункции

Процедура ТестДолжен_ПолучитьСписокМенеджеровЛицензий() Экспорт

    ПараметрыТестирования.УстановитьВыводИсполнителяКоманд(МониторАппаратныхКлючей.ИсполнительКоманд(), "МенеджерыЛицензий.Список");

    МенеджерыЛицензий = МониторАппаратныхКлючей.СписокМенеджеровЛицензий();

    Утверждения.ПроверитьБольше(МенеджерыЛицензий.Количество(), 0, 
        "Не удалось получить список менеджеров лицензий");

КонецПроцедуры

Процедура ТестДолжен_ПолучитьСписокКлючейМенеджеровЛицензий() Экспорт

    ПараметрыТестирования.УстановитьВыводИсполнителяКоманд(МониторАппаратныхКлючей.ИсполнительКоманд(), "АппаратныеКлючи.Список");

    ИдентификаторМенеджера = ПараметрыТестирования.Параметры().ИдентификаторМенеджера;
    АппаратныеКлючи = МониторАппаратныхКлючей.СписокКлючейМенеджераЛицензий(ИдентификаторМенеджера);

    Утверждения.ПроверитьБольше(АппаратныеКлючи.Количество(), 0, 
        "Не удалось получить ключей менеджера лицензий");

КонецПроцедуры

Процедура ТестДолжен_ПолучитьСписокПодключений() Экспорт

    ПараметрыТестирования.УстановитьВыводИсполнителяКоманд(МониторАппаратныхКлючей.ИсполнительКоманд(), "Подключения.Список");

    ИдентификаторМенеджера = ПараметрыТестирования.Параметры().ИдентификаторМенеджера;
    ПараметрыКлюча = Новый Структура("ИдентификаторМенеджера, ПорядковыйНомер", ИдентификаторМенеджера, "1");
    Подключения = МониторАппаратныхКлючей.СписокПодключений(ПараметрыКлюча);

    Утверждения.ПроверитьБольше(Подключения.Количество(), 0, 
        "Не удалось получить список подключений к ключу");

КонецПроцедуры
