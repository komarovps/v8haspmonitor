# v8haspmonitor

Библиотека для работы с консольной утилитой [`HaspMonitor`](https://www.zabbix.com/forum/in-russian/25155-%D0%9C%D0%BE%D0%BD%D0%B8%D1%82%D0%BE%D1%80%D0%B8%D0%BD%D0%B3-nethasp?postcount=4#post180721)

## Принцип работы

Библиотека подключается как отдельный класс и используется для вызова команд утилиты HaspMonotor. Экземпляру класса `МониторАппаратныхКлючей` требуется передать путь к файлу `nethasp.ini`. Он указывается либо в конфигурационном файле `params.json`

```json
{
    "hsmon-path": "./tools/HaspMonitor/HaspMonitor.exe",
    "nethasp-path": "./examples/nethasp.ini"
}
```
либо через конструктор класса:
```bsl
Монитор = Новый МониторАппаратныхКлючей(ПутьКФайлуНетхаспИни);
```
По умолчанию значения параметров берутся из файла `params.json`

## Пример работы

```bsl
#Использовать v8haspmonitor

МониторАппаратныхКлючей = Новый МониторАппаратныхКлючей();

ТаблицаМенеджеровЛицензий = МониторАппаратныхКлючей.СписокМенеджеровЛицензий();

Для Каждого МенеджерЛиценций Из ТаблицаМенеджеровЛицензий Цикл

    ТаблицаМодулей = МониторАппаратныхКлючей.СписокМодулейМенеджераЛицензий(
        МенеджерЛиценций.Идентификатор);

        Для Каждого Модуль Из ТаблицаМодулей Цикл
            ТаблицаПодключений = МониторАппаратныхКлючей.СписокПодключений(Модуль);	
        КонецЦикла;

КонецЦикла;
```

## Полезные ссылки
[HaspMonitor + Powershell + Zabbix](https://github.com/zbx-sadman/HASP)

[Prometheus экспортер для HASP License Manager](https://github.com/komarovps/v8hasp-exporter)